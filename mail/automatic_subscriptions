# This script will periodically check the foundation_db and automatically
# subscribe new Foundation members to the relevant mailing lists. (foundation-list 
# and foundation-announce)
# Author: Andrea Veri <av@gnome.org>

WORKDIR="/var/cache"
QUERY='SELECT email from foundationmembers WHERE TO_DAYS(first_added)=To_DAYS(NOW());'

mysql -N -r -h button-back --user=anonvoting --password=password -e "$QUERY" foundation > $WORKDIR/new_foundation_members

if [ -s "${WORKDIR}/new_foundation_members" ]; then
    cd $WORKDIR
    /usr/lib/mailman/bin/add_members -a n -r new_foundation_members foundation-list
    /usr/lib/mailman/bin/add_members -a n -r new_foundation_members foundation-announce
    rm -rf $WORKDIR/new_foundation_members
else
    echo "No new members to subscribe at the moment. Exiting. \n"
    exit 1
fi

